<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>My Reports ‚Äî CityFix</title>
    <style>
        body {
            font-family: Poppins;
            background: #f3f7fb;
            margin: 0;
            padding: 18px;
            color: #102132
        }

        .wrap {
            max-width: 920px;
            margin: 18px auto
        }

        .top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px
        }

        .card {
            background: #fff;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 12px;
            box-shadow: 6px 8px 18px rgba(15, 30, 50, 0.06)
        }

        .thumb {
            width: 160px;
            height: 110px;
            object-fit: cover;
            border-radius: 8px
        }

        .status {
            padding: 6px 10px;
            border-radius: 10px;
            font-weight: 700
        }

        .st-pend {
            background: #fff6dc;
            color: #7a5e00
        }

        .st-prog {
            background: #dff1ff;
            color: #004a66
        }

        .st-res {
            background: #e8ffe8;
            color: #0b5e18
        }

        .notif {
            background: #fffbe6;
            padding: 10px;
            border-left: 4px solid #ffd27a;
            margin-bottom: 12px;
            border-radius: 8px
        }

        .small {
            font-size: 13px;
            color: #687
        }
    </style>
</head>

<body>
    <button class="btn gray" onclick="goHome()">üè† Home</button>

    <div class="wrap">
        <div class="top">
            <h2>My Reports</h2>
            <a href="dashboard.html">‚Üê Back</a>
        </div>

        <div id="notifArea"></div>
        <div id="list"></div>
    </div>

    <script>
        /* --------------- LOGIN CHECK --------------- */
        const user = JSON.parse(localStorage.getItem("user"));
        const logged = localStorage.getItem("userLogged");

        if (!user || logged !== "true") {
            alert("Please login first");
            location.href = "login.html";
        }

        /* --------------- GET LOCAL DATA --------------- */
        function getReports() { return JSON.parse(localStorage.getItem("reports") || "[]"); }
        function getNotifs() { return JSON.parse(localStorage.getItem("notifications") || "[]"); }

        /* --------------- NOTIFICATIONS --------------- */
        function renderNotifications() {
            const notes = getNotifs().filter(n => n.email === user.email)
                .sort((a, b) => new Date(b.time) - new Date(a.time));

            if (notes.length === 0) {
                document.getElementById("notifArea").innerHTML = "";
                return;
            }

            let html = `<div class="notif"><strong>Notifications</strong><ul>`;
            notes.forEach(n => {
                html += `<li style="margin:6px 0">${new Date(n.time).toLocaleString()} ‚Äî ${n.message}</li>`;
            });
            html += `</ul></div>`;
            document.getElementById("notifArea").innerHTML = html;
        }

        /* --------------- USER REPORT LIST --------------- */
        function renderList() {
            const reports = getReports().filter(r => r.userEmail === user.email)
                .sort((a, b) => new Date(b.time) - new Date(a.time));

            const c = document.getElementById("list");
            c.innerHTML = "";

            if (reports.length === 0) {
                c.innerHTML = `<div class="card">No reports yet. <a href="report.html">Report now</a></div>`;
                return;
            }

            reports.forEach(r => {
                const div = document.createElement("div");
                div.className = "card";

                div.innerHTML = `
        <div style="display:flex;gap:12px">
            ${r.photo ? `<img class="thumb" src="${r.photo}">`
                        : `<div style="width:160px;height:110px;background:#eef;border-radius:8px;display:flex;align-items:center;justify-content:center;color:#667">No image</div>`}
            
            <div style="flex:1">
                <h3 style="margin:0">${escape(r.issue)}</h3>
                <p style="margin:6px 0;color:#455">${escape(r.description)}</p>
                <div style="display:flex;gap:8px;align-items:center">
                    <span class="status ${r.status === 'Pending' ? 'st-pend' : r.status === 'In-Progress' ? 'st-prog' : 'st-res'}">${r.status}</span>
                    <div class="small">Submitted: ${new Date(r.time).toLocaleString()}</div>
                </div>
            </div>
        </div>`;

                c.appendChild(div);
            });
        }

        function escape(s) { return ("" + s).replace(/[&<>"]/g, m => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;" }[m])); }

        renderNotifications();
        renderList();
        function goHome() {
    window.location.href = "index.html";
}

    </script>
</body>

</html>